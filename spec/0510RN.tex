% Random Number generators
\section{Генерация случайных чисел (СЧ)}\label{RN}

\subsection{Обзор}\label{RN.Intro}

Пакет СЧ устанавливает требования к генераторам случайным чисел, которые
используются СКЗИ для создания секретных и личных ключей, синхропосылок, других
критических или уникальных объектов.

Генератор случайных чисел выдает последовательности, каждый следующий элемент
которых статистически и вычислительно трудно предсказать по всем предыдущим
элементам.
%
Генератор использует один или несколько источников случайности
(неопределенности, энтропии) и включает средства обработки данных от 
источников~\addendum{\forref{R.RN.Spec}}.

В компьютерных системах используются следующие источники случайности: 
\begin{itemize}
\item[--]
физические источники, использующие процессы в физических устройствах (например,
шум в радиоэлектронных и оптических приборах);

\item[--]
системные источники, использующие состояния, процессы и события системной среды
(системное время, сетевая активность, прерывания);

\item[--]
источники, основанные на активности операторов (движения мышью, нажатия 
клавиш)~\forref{R.RN.Spec}.
\end{itemize}

Предпочтение следует отдавать физическим источникам случайности.

Для источника случайности $S$ проводится оценка энтропии (неопределенности,
вариабельности) его выходных последовательностей. Для этого строится
вероятностная модель~$S$ и в рамках этой модели определяется величина~$h_{min}$,
которая характеризует сложность предсказания самой вероятной выходной 
последовательности~$S$.  
%
Если~$S$ выдает случайные независимые символы алфавита~$A$ и
вероятность появления символа~$\alpha$ равняется~$p(\alpha)$, то
$$
h_{min}=\min_{\alpha\in A}(-\log_2 p(\alpha))
$$
Если выходные символы зависимы, а вероятность появления 
последовательности $(\alpha_1,\alpha_2,\ldots,\alpha_n)$ 
равняется~$p(\alpha_1,\alpha_2,\ldots,\alpha_n)$, 
то
$$
h_{min}=\frac{1}{n}\min(-\log_2 p(\alpha_1,\alpha_2,\ldots,\alpha_n)),
$$
где минимум берется по всем $\alpha_1,\alpha_2,\ldots,\alpha_n\in A$.
%
Величина $h_{min}$ называется минимальной удельной энтропией,
в настоящем стандарте~--- просто энтропией~\forref{R.RN.Entropy}.

Оценка~$h_{min}$ является сложной задачей, если распределение вероятностей 
известно не полностью или не является стационарным,
при сложных зависимостях между символами~$S$ и в других ситуациях.
%
Для оценки~$h_{min}$ вероятностная модель~$S$ может упрощаться,
может проводиться статистическое оценивание по экспериментальным
данным от источников случайности~\forref{R.RN.Entropy}.

Оценив удельную энтропию~$h_{min}$ источника, можно оценить 
энтропию его выходных последовательностей длины~$n$: она равняется 
$n h_{min}$. Совокупная энтропия выходных данных всех источников 
случайности оценивается суммой таких выражений~\forref{R.RN.Entropy}.

При включении СКЗИ проверяется работоспособность физических источников 
случайности его генераторов. Проверка направлена на обнаружение отказов, она 
может быть достаточно простой. Например, может проверяться, что данные от 
источников не состоят из всех нулей, всех единиц или попеременно нулей и 
единиц.
%
Проверка работоспособности может требоваться всякий раз перед генерацией 
критических объектов~\forref{R.RN.TotTest,R.RN.GenCrit}.

Кроме проверки работоспособности физических источников, предусмотрено 
статистическое тестирование их выходных данных. Могут обрабатываться
данные всех источников в совокупности, и поэтому речь идет о статистическом 
тестировании генератора.
%
Тестировать следует данные, не прошедшие криптографическую обработку 
(см. далее), но возможно подготовленные к ней~\forref{R.RN.Tests}.

При тестировании могут возникать <<ложные тревоги>>~--- ситуации, когда 
корректно работающий генератор признается сбойным. 
% 
Cледует контролировать уровень <<ложных тревог>> и допускать их разумно 
редко, не игнорируя впрочем <<боевые тревоги>>. 
%
%Например, в случае тревоги провести тестирование еще раз и признать сбой, 
%только если второй тест также дает отрицательный результат.
%
\addendum{В~\ref{RNG.StatTest} даны примеры расчета вероятности 
<<ложной тревоги>> при длительной эксплуатации генератора~\forref{R.RN.Tests}.}  

Данные от источников случайности перед выпуском в качестве случайных чисел
обрабатываются с помощью криптографических алгоритмов. При этом устанавливаются
сложные нелинейные зависимости между выходными битами и данными от источников, 
что в целом повышает статистическое качество и криптографическую надежность
генератора. 
%
Более того, при правильной криптографической обработке генератор будет 
защищен от некоторых атак. Для защиты следует предусмотреть внутреннее 
состояние генератора. Оно обновляется по данным от источников и по нему 
строятся выходные случайные числа. Обновление следует организовать  
так, что:
\begin{enumerate}[label=\arabic*)]
\item
по случайным числам вычислительно трудно определить состояние;
\item
по текущему состоянию трудно определить предыдущие случайные числа;
\item
по текущему состоянию без данных от источников 
трудно определить будущие случайные числа;
\item
по данным от источников без текущего состояния
трудно определить будущие случайные числа~\forref{R.RN.Crypto}.
\end{enumerate}
% Начальное состояние можно строить по секретному ключу.

В качестве источника случайности может выступать уже готовый генератор.
Если в этом генераторе используется физический источник, то и он сам считается 
физическим источником~\forref{R.RN.Spec}.

Если вложенный генератор-как-источник удовлетворяет требованиям настоящего пакета, 
то его выходные данные можно использовать напрямую, без криптографической
обработки, а их удельная энтропия может быть оценена как максимально 
возможная~\forref{R.RN.Entropy,R.RN.Crypto}.

Дополнительные сведения о принципах построения генераторов 
случайных чисел даны в приложении~\ref{RNG}.

\subsection{Требования}\label{RN.Reqs}

\req{СЧ}{1--4}\label{R.RN.Spec}
Должны быть определены генераторы случайных чисел, 
которые используются для выработки ключей и других критических 
объектов~\useref{R.CS.Gen}. 
%
Для каждого генератора должны быть указаны 
источники случайности и методы обработки данных от источников случайности.
%
Физические источники случайности должны быть~\forref{R.ST.CSCList} включены в 
список КСК.

\req{СЧ}{1--4}\label{R.RN.Entropy}
Для каждого генератора случайных чисел~\useref{R.RN.Spec}
должна быть проведена оценка энтропии всех его источников случайности. 
%
Способ обработки данных от источников случайности должен гарантировать, 
что совокупная энтропия данных, использованных для генерации~$l$-битового 
случайного числа, не меньше~$l$.

\req{СЧ}{1}\label{R.RN.Source1}
Если в генераторе случайных чисел~\useref{R.RN.Spec} отсутствуют физические 
источники случайности, то должно использоваться не менее 
двух разных альтернативных источников.

\begin{note*}
Можно использовать два разных системных источника или один системный источник и 
один источник, основанный на активности оператора.
\end{note*}

\req{СЧ}{2--4}\label{R.RN.Source2}
Генератор случайных чисел~\useref{R.RN.Spec} должен обязательно
использовать хотя бы один физический источник случайности.

\req{СЧ}{1--4}\label{R.RN.Tests}
Должна быть разработана и \addendum{корректно 
реализована~\forref{R.CR.Selected,R.CR.Detailed}}
процедура статистического тестирования генератора случайных 
чисел~\useref{R.RN.Spec}, в котором используются физические источники 
случайности.
%
Процедура должна быть направлена на выявление сбоев и изменений физических
параметров при функционировании физических источников.
%
Процедура должна быть~\forref{R.ST.Tests} включена в перечень тестов 
работоспособности СКЗИ. Тестирование генератора должно проводиться перед 
первым его использованием. 

\req{СЧ}{1--4}\label{R.RN.Crypto}
Выходные данные генератора случайных чисел~\useref{R.RN.Spec}
должны являться результатом применения криптографических 
алгоритмов~\useref{R.CS.Algs} к данным от источников случайности, 
возможно дополненным обновляемым внутренним состоянием
или предыдущими случайными числами.
%
Применяемые криптографические алгоритмы должны 
обеспечивать сложные зависимости между выходными данными генератора и 
данными от каждого из источников случайности.
%
Внутреннее состояние генератора, если оно используется,
должно быть~\forref{R.AC.Policy} отнесено к критическим объектам.

\req{СЧ}{1--4}\label{R.RN.TotTest}
%
Должна быть разработана и \addendum{корректно 
реализована~\forref{R.CR.Selected,R.CR.Detailed}} проверка 
работоспособности физических источников случайности~\useref{R.RN.Spec} 
как КСК.

\req{СЧ}{3, 4}\label{R.RN.GenCrit}
Всякий раз перед созданием критических объектов~\useref{R.AC.Objects} 
с помощью генератора случайных чисел~\useref{R.RN.Spec} должна проверяться
работоспособность его физических источников случайности. 
%
При отрицательном результате проверки создание критических объектов должно быть 
запрещено.
